<!DOCTYPE html>
<html>
  <head>
  <!--
     -
     - Awesome New Tab Page
     -   Copyright 2011 Michael Hart (http://h4r7.me/).
     - 
     - Want to make it even more awesome?
     -   https://github.com/michaelhart/Awesome-New-Tab-Page/
     -
     - Licensed under GPL v3:
     -   http://www.gnu.org/licenses/gpl-3.0.txt
     -
     -->
    <title>New Tab</title>

    <link
      href='http://fonts.googleapis.com/css?family=Droid+Sans&subset=latin'
      rel='stylesheet' type='text/css'>

    <link rel="canonical" href="https://chrome.google.com/webstore/detail/mgmiemnjjchgkmgbeljfocdjjnpjnmcg" />
    <link rel="publisher" href="https://plus.google.com/101062285048075360930" />
    <link rel="stylesheet" href="/css/core.bookmarkbar.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/colorpicker/css/colorpicker.css" type="text/css" media="screen">
    <link rel="shortcut icon" href="/images/favicon-20111025.png">

    <link rel="stylesheet" href="core.style.css?nocache=1" type="text/css" media="screen">

    <script type="text/javascript" src="/javascript/jquery.js"></script>
    <script type="text/javascript" src="/javascript/tilesystem.js"></script>
    <script type="text/javascript" src="/javascript/jquery.qtip-1.0.0-rc3.min.js"></script>
    <script type="text/javascript" src="/javascript/center.js"></script>
    <script type="text/javascript" src="/colorpicker/js/colorpicker.js"></script>

    <script>
        var bp = chrome.extension.getBackgroundPage();
        var port = chrome.extension.connect({name: "NTP-Port"});
        var extensions = {};
        var widgets = {};

        function reset() {
          localStorage.clear();
        }

        function reload() {
          window.location.reload( false );
        }

        stock_widgets = {
          webstore: {
            where: [2,3],
            size: [1,1],
            isApp: true,
            enabled: true,
            name: "Chrome Web Store",
            color: "rgba(0, 16, 186, 0.5)",
            id: "webstore",
            stock: true,
            img: "app.webstore.png",
            appLaunchUrl: "https://chrome.google.com/webstore?utm_source=google-chrome-extension&utm_medium=awesomenewtabpage&utm_campaign=awesomenewtabpage",
          },
          tutorial: {
            where: [0,0],
            size: [2,2],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Tutorial (Stock)",
            id: "tutorial",
            path: "widgets/widget.tutorial.html",
          },
          clock: {
            where: [1,3],
            size: [1,1],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Clock (Stock)",
            id: "clock",
            path: "widgets/widget.clock.html",
          },
          notepad: {
            where: [1,2],
            size: [1,1],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Notepad (Stock)",
            id: "notepad",
            path: "widgets/widget.notepad.html",
          },
          google: {
            where: [0,2],
            size: [1,2],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Google (Wide) (Stock)",
            id: "google",
            path: "widgets/widget.google.html",
          },
          fandango: {
            where: [2,1],
            size: [1,1],
            type: "app",
            isApp: true,
            stock: true,
            name: "Fandango (Stock)",
            name_show: false,
            color: "rgba(10, 58, 148, .5)",
            img: "/widgets/widget.fandango.png",
            url: "http://gan.doubleclick.net/gan_click?lid=41000000032569141&amp;pubid=21000000000503246",
            id: "fandango",
          },
          amazon: {
            where: [2,2],
            size: [1,1],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Amazon (Stock)",
            id: "amazon",
            path: "widgets/widget.amazon.html",
          },
          tv: {
            where: [2,0],
            size: [1,1],
            type: "iframe",
            isApp: false,
            stock: true,
            name: "Hulu / Netflix (Stock)",
            id: "tv",
            path: "widgets/widget.tv.html",
          }
        };

        if(JSON.parse(localStorage.getItem("widgets")) === null) {
          localStorage.setItem("widgets", JSON.stringify( stock_widgets ));
        }

        var palette = 
        [
          "rgba(51, 153, 51, .5)",
          "rgba(229, 20, 0, .5)",
          "rgba(27, 161, 226, .5)",
          "rgba(240, 150, 9, .5)",
          "rgba(230, 113, 184, .5)",
          "rgba(153, 102, 0, .5)",
          "rgba(139, 207, 38, .5)",
          "rgba(255, 0, 151, .5)",
          "rgba(162, 0, 225, .5)",
          "rgba(0, 171, 169, .5)"
        ];

        function localStorageSync(re) {
          localStorage.setItem("widgets", JSON.stringify( widgets ));

          if(re === true) {
            reload();
          }
        }

        widgets = JSON.parse(localStorage.getItem("widgets"));

        function setupDrawerApps(_extensions) {
          if($.isArray( _extensions )) {

            extensions = _extensions;
            _extensions.push(stock_widgets.webstore);
            _extensions.push(stock_widgets.fandango);

            $.each(_extensions, function(index, value) {
              if(value.isApp === true && value.enabled === true) {
                if(value.stock === true) {
                  var app_img_url = value.img;
                } else {
                  var app_img_url = "chrome://extension-icon/" + value.id + "/128/0";
                }

                $(stitch(
                  /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "app-drawer",
                  /*  Destination: str [home, app-drawer, widget-drawer]*/  "app-drawer",
                  /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  value.id,
                  /*  Ext. Name: str [Awesome New Tab Page]             */  value.name,
                  /*  URL: str, can be iframe or app url                */  value.appLaunchUrl,
                  /*  Img: str, full path or [id]                       */  ( app_img_url ),
                  /*  Height: int [1, 2, 3]                             */  1,
                  /*  Width: int [1, 2, 3]                              */  1,
                  /*  Top: int                                          */  null,
                  /*  Left: int                                         */  null,
                  /*  Poke: int                                         */  null
                )).appendTo(".ui-2#apps > .contents");
              }
            });
          }
        }

        // Listen to background.html
        port.onMessage.addListener(function(msg) {
            if(!msg.fn || !msg.data) {
              return false;
            }

            if(typeof window[msg.fn] === 'function') {
                window[msg.fn](msg.data);
            }
        });
        
        /*  Type: str [app, widget, app-drawer, widget-drawer]  */
        /*  Destination: str [home, app-drawer, widget-drawer]  */
        /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]     */
        /*  Ext. Name: str [Awesome New Tab Page]               */
        /*  URL: str, can be iframe or app url                  */
        /*  Img: str, full path or [id]                         */
        /*  Height: int [1, 2, 3]                               */
        /*  Width: int [1, 2, 3]                                */
        /*  Top: int                                            */
        /*  Left: int                                           */
        /*  Poke: int                                           */
        var gradient = ", -webkit-gradient( linear, right bottom, left top, color-stop(1, rgba(255, 255, 255, .04)), color-stop(0, rgba(255, 255, 255, 0.35)) )";
        function stitch(type, destination, id, name, url, img, height, width, top, left, poke) {
          widgets = JSON.parse(localStorage.getItem("widgets"));

          var stitch = "";

          if(!type || !destination || !height || !width) {
            return false;
          }

          if(!url) {
            if(id === "webstore") {
              url = "https://chrome.google.com/webstore?utm_source=google-chrome-extension&utm_medium=awesomenewtabpage&utm_campaign=awesomenewtabpage";
            } else {
              return [false, "Not webstore & no URL"];
            }
          }

          if(type === "app" || type === "shortcut") {
            if(widgets[id].color) {
              background_color = widgets[id].color;
            } else {
              new_background_color = palette[Math.floor(Math.random() * palette.length)];
              background_color = new_background_color;
              widgets[id].color = new_background_color;
              localStorageSync(false);
            }

            if(widgets[id].name_show === false) {
              name_show = "opacity-0";
            } else {
              name_show = "";
            }

            if(widgets[id].shortcut_background_transparent && widgets[id].shortcut_background_transparent === true) {
              background_color = "transparent";
              use_gradient = "";
            } else {
              use_gradient = gradient;
            }
          }

          if(height > 3 || width > 3) return [false, "Too big"];

          if(img === "id") {
            if(type === "app" || type === "shortcut") {
              if(widgets[id].stock === true && widgets[id].type === "app") {
                img = widgets[id].img;
              } else {
                img = "chrome://extension-icon/" + id + "/128/0";
              }
            } else {
              img = "chrome://extension-icon/" + id + "/128/0";
            }
          }

          if(type === "app") {
            stitch += '<div class="widget app" style="position:absolute; background-image: url('+encodeURI(img)+')'+use_gradient+'; ';
            stitch += 'background-color: ' + background_color + ';"';
            // if(background_color != {r:0,g:0,b:0}) {
            //   stitch += 'background-color: rgba('+background_color.r+','+background_color.g+','+background_color.b+',0.9);';
            // }
            stitch += '" ';
          } else if (type === "iframe") {
            stitch += '<div class="widget" style="position:absolute;" ';
          } else if (type === "shortcut") {
            stitch += '<div class="widget app shortcut" style="position:absolute; background-image: url('+encodeURI(img)+')'+use_gradient+'; ';
            stitch += 'background-color: ' + background_color + ';"';
          } else if (type === "widget-drawer") {
            stitch += '<div class="widget app drawer-app ui-2 ilb" ';
            stitch += 'data-app-source="from-drawer" data-widget="true" data-stock="'+id+'" ';
            stitch += 'data-poke="' + poke + '" ';
            stitch += 'data-widget-src="' + url + '" ';
            stitch += 'data-tile-height="' + height + '" ';
            stitch += 'data-tile-width="' + width + '" ';
          } else if (type === "app-drawer") {
            stitch += '<div class="widget app drawer-app ui-2 ilb"';
            stitch += 'id="' + id + '" data-app-source="from-drawer" ';
            stitch += 'data-tile-height="1" data-tile-width="1" ';
          } else {
            return [false, "Unknown type"];
          }

          stitch += 'id="' + id + '" ';
          stitch += 'data-tile-height="' + height + '" ';
          stitch += 'data-tile-width="' + width + '" ';

          if(destination === "home") {
            stitch += 'inittop="' + top + '" ';
            stitch += 'initleft="' + left + '" ';
          }

          stitch += '>\n';

          if(type === "app") {
            // stitch += '<img src="' + img + '" class="opacity-0"> ';
            stitch += '<div class="app-name '+name_show+'">' + name + '</div> ';
            stitch += '<a href="' + url + '"><div class="app-mask">&nbsp;</div></a> ';
            stitch += '<div class="iframe-mask hidden"><div id="delete">&nbsp;</div><div id="shortcut-edit">&nbsp;</div></div>\n ';
          } else if (type === "iframe") {
            stitch += '<iframe src="' + url + '" scrolling="no" frameborder="0" ';
            stitch += 'align="center" height="100%" width="100%"></iframe> ';
            stitch += '<div class="iframe-mask hidden"><div id="delete">&nbsp;</div></div>\n ';
          } else if (type === "shortcut") {

            // stitch += '<img src="' + img + '" class="opacity-0"> ';
            stitch += '<div class="app-name '+name_show+'">' + name + '</div> ';
            stitch += '<a href="' + url + '"><div class="app-mask">&nbsp;</div></a> ';
            stitch += '<div class="iframe-mask hidden"><div id="delete">&nbsp;</div><div id="shortcut-edit">&nbsp;</div></div>\n ';

          } else if (type === "widget-drawer") {
            stitch += '<img class="ui-2 ilb" src="' + img + '"> ';
            stitch += '<div class="ui-2 drawer-app-name ilb">' + name + '</div> ';
            // stitch += '<div class="app-mask">&nbsp;</div> ';
            // stitch += '<div class="iframe-mask o'+width+'x'+height+'"  ';
            // stitch += 'style="display: block !important;">&nbsp;</div> ';
            stitch += '<div class="ui-2 drawer-app-wh ilb">'+width+' Wide, '+height+' Tall</div>';
            if(id !== "webstore" && id !== "mgmiemnjjchgkmgbeljfocdjjnpjnmcg") {
              stitch += '<div class="ui-2 drawer-app-uninstall ilb">Remove</div>';
            }
          } else if (type === "app-drawer") {
            stitch += '<img class="ui-2 ilb url" src="' + img + '" data-url="' + url + '">';
            stitch += '<div class="ui-2 drawer-app-name ilb url"  data-url="' + url + '">' + name + '</div> ';
            // stitch += '<a href="' + url + '"><div class="app-mask"><div id="uninstall">&nbsp;</div></div></a> ';
            // stitch += '<div class="iframe-mask url" data-url="' + url + '"><div id="uninstall">&nbsp;</div></div> ';
            if(id !== "webstore" && id !== "mgmiemnjjchgkmgbeljfocdjjnpjnmcg") {
              stitch += '<div class="ui-2 drawer-app-uninstall ilb">Remove</div>';
            }
          }

          stitch += '</div>';
          // console.log(stitch);
          return stitch;
        }

        // Only handles 1 at a time; widget
        function setupDrawerWidgets(_widget) {
          // try {
            if(!_widget.request || !_widget.sender) {
              return false;
            }
            if(!_widget.request.body) {
              return false;
            }
            if(_widget.request.body.poke === 1) {
              widgets[_widget.sender.id] = _widget.body;

              if( parseInt(_widget.request.body.height) > 3 || parseInt(_widget.request.body.width) > 3 ) {
                return false;
              }

              var widget_name = null;
              if(_widget.sender.name) {
                widget_name = _widget.sender.name;
              } else {
                widget_name = extensions.filter(function (ext) { return ext.id === _widget.sender.id})[0].name;
              }

              var widget_img = null;
              if(_widget.sender.id === "mgmiemnjjchgkmgbeljfocdjjnpjnmcg") {
                widget_img = "icon128.png";
              } else {
                widget_img = 'chrome://extension-icon/' + _widget.sender.id + '/128/0"';
              }

              $(stitch(
                /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "widget-drawer",
                /*  Destination: str [home, app-drawer, widget-drawer]*/  "widget-drawer",
                /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  _widget.sender.id,
                /*  Ext. Name: str [Awesome New Tab Page]             */  widget_name,
                /*  URL: str, can be iframe or app url                */  (_widget.request.body.path).replace(/\s+/g, ''),
                /*  Img: str, full path or [id]                       */  ( "id" ),
                /*  Height: int [1, 2, 3]                             */  parseInt(_widget.request.body.height),
                /*  Width: int [1, 2, 3]                              */  parseInt(_widget.request.body.width),
                /*  Top: int                                          */  null,
                /*  Left: int                                         */  null,
                /*  Poke: int                                         */  parseInt(_widget.request.body.poke)
              )).prependTo("#widget-drawer");

              return;
            }
          // }
          // catch (err) {
          //   _e(5);
          // }
        }

        function placeWidgets() {
          if(JSON.parse(localStorage.getItem("widgets")) === null) {
            localStorage.setItem("widgets", JSON.stringify( stock_widgets ));
          }

          widgets = JSON.parse(localStorage.getItem("widgets"));

          $.each(widgets, function(id, widget){
            if(widget.type === "iframe" && widget.size[0] <= 3 && widget.size[1] <= 3) {
              $(stitch(
                /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "iframe",
                /*  Destination: str [home, app-drawer, widget-drawer]*/  "home",
                /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  id,
                /*  Ext. Name: str [Awesome New Tab Page]             */  widget.name,
                /*  URL: str, can be iframe or app url                */  widget.path,
                /*  Img: str, full path or [id]                       */  "id",
                /*  Height: int [1, 2, 3]                             */  widget.size[0],
                /*  Width: int [1, 2, 3]                              */  widget.size[1],
                /*  Top: int                                          */  widget.where[0],
                /*  Left: int                                         */  widget.where[1],
                /*  Poke: int                                         */  null
              )).appendTo("#widget-holder");
            }

            if(widget.isApp === true) {
              img = false;
              if( id === ("webstore") ) {
                img = "app.webstore.png";
              }

              $(stitch(
                /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "app",
                /*  Destination: str [home, app-drawer, widget-drawer]*/  "home",
                /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  id,
                /*  Ext. Name: str [Awesome New Tab Page]             */  widget.name,
                /*  URL: str, can be iframe or app url                */  widget.url ,
                /*  Img: str, full path or [id]                       */  ( img || "id" ),
                /*  Height: int [1, 2, 3]                             */  widget.size[0],
                /*  Width: int [1, 2, 3]                              */  widget.size[1],
                /*  Top: int                                          */  widget.where[0],
                /*  Left: int                                         */  widget.where[1],
                /*  Poke: int                                         */  null
              )).appendTo("#widget-holder");
            }

            if(widget.type === "shortcut") {

              $(stitch(
                /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "shortcut",
                /*  Destination: str [home, app-drawer, widget-drawer]*/  "home",
                /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  id,
                /*  Ext. Name: str [Awesome New Tab Page]             */  widget.name,
                /*  URL: str, can be iframe or app url                */  widget.appLaunchUrl,
                /*  Img: str, full path or [id]                       */  widget.img,
                /*  Height: int [1, 2, 3]                             */  widget.size[0],
                /*  Width: int [1, 2, 3]                              */  widget.size[1],
                /*  Top: int                                          */  widget.where[0],
                /*  Left: int                                         */  widget.where[1],
                /*  Poke: int                                         */  null
              )).appendTo("#widget-holder");
            }

          });

          setStuff();
        }

        function new_guid() {
          var S4 = function() {
            return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
          };
          return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
        }

        $(".unlocked .empty.add-shortcut").live("click", function() {
          var new_shortcut_id = new_guid();

          addShortcut(
            new_shortcut_id,
            $(this).attr("data-land-top"),
            $(this).attr("data-land-left")
          );

          $(stitch(
            /*  Type: str [app, widget, app-drawer, widget-drawer]*/  "shortcut",
            /*  Destination: str [home, app-drawer, widget-drawer]*/  "home",
            /*  Ext. ID: str [mgmiemnjjchgkmgbeljfocdjjnpjnmcg]   */  new_shortcut_id,
            /*  Ext. Name: str [Awesome New Tab Page]             */  "Google",
            /*  URL: str, can be iframe or app url                */  "http://www.google.com/",
            /*  Img: str, full path or [id]                       */  "core.shortcut.blank2.png",
            /*  Height: int [1, 2, 3]                             */  1,
            /*  Width: int [1, 2, 3]                              */  1,
            /*  Top: int                                          */  $(this).attr("data-land-top"),
            /*  Left: int                                         */  $(this).attr("data-land-left"),
            /*  Poke: int                                         */  null
          )).appendTo("#widget-holder");
          
          $("#" + new_shortcut_id).css({
            "left": $(this).position().left,
            "top": $(this).position().top,
            "width": "200",
            "height": "200",
            "zIndex": "1"
          }).find(".iframe-mask").removeClass("hidden").find("#shortcut-edit").trigger("click");

          $(this).removeClass("add-shortcut").removeClass("empty");
        });

        $("#delete,#shortcut-edit").live("mousedown mouseup move", function(e) {
          e.stopPropagation();
          e.preventDefault();
        });

        $("#shortcut-edit").live("click", function(e){
          var shortcut_parent = $(this).parent().parent()[0];
          if(!shortcut_parent) { console.warn("!shortcut_parent", this, shortcut_parent); return; }

          widgets = JSON.parse(localStorage.getItem("widgets"));
          var id = $(shortcut_parent)[0].id;
          if(!widgets[id]) { console.warn("!widgets["+id+"]", shortcut_parent, widgets); return; }

          if(widgets[id].type && widgets[id].type === "shortcut") {
            shortcut_type = "shortcut";
            $(".hide-if-app").show();
          } else {
            shortcut_type = "app";
            $(".hide-if-app").hide();
          }

          if(id === "webstore") {
            widgets[id].img = "/app.webstore.png";
          }

          $(".ui-2#editor")
            .fadeIn()
            .attr("active-edit-id", id)
            .attr("active-edit-type", shortcut_type);

          if(widgets[id].shortcut_background_transparent && widgets[id].shortcut_background_transparent === true) {
            $(".ui-2#editor #shortcut_background_transparent").prop("checked", true);
            $(".ui-2#editor #preview-tile")
              .css("background-image", "url("+widgets[id].img+")")
              .css("background-color", "transparent");
          } else {
            $(".ui-2#editor #shortcut_background_transparent").prop("checked", false);
            $(".ui-2#editor #preview-tile")
              .css("background-image", "url("+widgets[id].img+")" + gradient)
              .css("background-color", widgets[id].color);
          }

          $(".ui-2#editor #editor-name, .ui-2#editor #preview-tile .app-name").html( widgets[id].name );
          $(".ui-2#editor #shortcut_name").val( widgets[id].name );

          if(typeof( widgets[id] ) != "undefined" && widgets[id].name_show === false) {
            $(".ui-2#editor #shortcut_name_show").prop("checked", false);
            $(".ui-2#editor .app-name").css("opacity", 0);
          } else {
            $(".ui-2#editor #shortcut_name_show").prop("checked", true);
            $(".ui-2#editor .app-name").css("opacity", 1);
          }

          $(".ui-2#editor #img_url").val( widgets[id].img );

          $(".ui-2#editor #shortcut_url").val( widgets[id].url || widgets[id].appLaunchUrl );

          var rgb = [];
          rgb = (widgets[$(".ui-2#editor").attr("active-edit-id")].color).match(/(rgba?)|(\d+(\.\d+)?%?)|(\.\d+)/g);

          $(".ui-2#editor #shortcut_colorpicker").ColorPicker({
            color: ( ({ r: rgb[1], g: rgb[2], b: rgb[3] }) || "#309492") ,
            onShow: function (colpkr) {
              widgets  = JSON.parse(localStorage.getItem("widgets"));
              $(colpkr).fadeIn(500);
              return false;
            },
            onHide: function (colpkr) {
              $(colpkr).fadeOut(500);
              return false;
            },
            onChange: function (hsb, hex, rgb) {
              widgets  = JSON.parse(localStorage.getItem("widgets"));
              var id = $(".ui-2#editor").attr("active-edit-id");
              $("#"+id).css('backgroundColor', "rgba("+rgb.r+","+rgb.g+","+rgb.b+",.5)" );
              $(".ui-2#editor .fake-tile#preview-tile").css('backgroundColor', "rgba("+rgb.r+","+rgb.g+","+rgb.b+",.5)" );
              widgets[id].color = "rgba("+rgb.r+","+rgb.g+","+rgb.b+", .5)";
              localStorageSync(false);
              updateShortcut();
            }
          });

          $(".ui-2#editor #shortcut_colorpicker").ColorPickerSetColor( ({ r: rgb[1], g: rgb[2], b: rgb[3] }) );
        });


        $(".ui-2#editor input").live('keyup change', updateShortcut);

        function updateShortcut(e) {
          try {
            widgets  = JSON.parse(localStorage.getItem("widgets"));
            var id   = $(".ui-2#editor").attr("active-edit-id");
            var type = $(".ui-2#editor").attr("active-edit-type")
            var name = $(".ui-2#editor #shortcut_name").val();
            var url  = $(".ui-2#editor #shortcut_url").val();
            var img  = $(".ui-2#editor #img_url").val();
            var name_show  = $(".ui-2#editor #shortcut_name_show").is(':checked');
            var shortcut_background_transparent  = $(".ui-2#editor #shortcut_background_transparent").is(':checked');

            if(id === "webstore") {
              widgets[id].img = "/app.webstore.png";
            }

            widgets[id].name_show = name_show;
            if(name_show === false) {
              $(".ui-2#editor #shortcut_name_show").prop("checked", false);
              $(".ui-2#editor .app-name, #widget-holder #"+id+" .app-name").css("opacity", 0);
            } else {
              $(".ui-2#editor #shortcut_name_show").prop("checked", true);
              $(".ui-2#editor .app-name, #widget-holder #"+id+" .app-name").css("opacity", 1);
            }

            widgets[id].shortcut_background_transparent = shortcut_background_transparent;

            if(type === "shortcut") {
              widgets[id].img = img;

              $("#" + id + " a").attr("href", url);
              widgets[id].appLaunchUrl = url;
              widgets[id].url = url;
            }

            if(widgets[id].shortcut_background_transparent && widgets[id].shortcut_background_transparent === true) {
              $(".ui-2#editor #preview-tile, #widget-holder #"+id)
                .css("background-image", "url("+widgets[id].img+")")
                .css("background-color", "transparent");
            } else {
              $(".ui-2#editor #preview-tile, #widget-holder #"+id)
                .css("background-image", "url("+widgets[id].img+")" + gradient)
                .css("background-color", widgets[id].color);
            }

            $("#" + id + " .app-name, .ui-2#editor #editor-name, .ui-2#editor #preview-tile .app-name").html(name);

            localStorageSync(false);
          }
          catch (err) {
            _e(7);
          }
        }

        function addShortcut(widget, top, left) {
          try {
            widgets = JSON.parse(localStorage.getItem("widgets"));

            widgets[widget] = {
              where: [top,left],
              size: [1,1],
              type: "shortcut",
              isApp: false,
              name: "Google",
              id: widget,
              img: "core.shortcut.blank2.png",
              appLaunchUrl: "http://www.google.com/",
            };

            localStorageSync(false);
          }
          catch (err) {
            _e(6);
          }
        }

        function updateWidget(widget, top, left) {
          try {
            widgets = JSON.parse(localStorage.getItem("widgets"));
            if(!widgets[widget]) return;

            widgets[widget].where = [top, left];

            localStorageSync();
          }
          catch (err) {
            _e(2);
          }
        }

        function addWidget(is_widget, widget, top, left, src, width, height, poke, stock) {
          try {
            widgets = JSON.parse(localStorage.getItem("widgets"));
            var new_ext_data = null;
            var widget_img = null;
            var appLaunchUrl = null;
            var widget_name = null;
            var widget_src = null;
            if(!height) height = 1;
            if(!width) width = 1;

            if(stock) {
              if(is_widget === false) {
                widget_img = stock.img;
                appLaunchUrl = stock.appLaunchUrl;
              } else {
                widget_src = stock.path;
              }
              widget_name = stock.name;
              widget = stock.id;
            } else {
              new_ext_data = extensions.filter(function (ext) { return ext.id === widget})[0];
              if(is_widget === false) {
                widget_img = "chrome://extension-icon/"+new_ext_data.id+"/128/0";
                appLaunchUrl = new_ext_data.appLaunchUrl;
              } else {
                widget_src = "chrome-extension://"+new_ext_data.id+"/" + src.replace(/\s+/g, '');
              }
              widget_name = new_ext_data.name;
            }

            if(widget === "mgmiemnjjchgkmgbeljfocdjjnpjnmcg") {
              widget = new_guid();
            }

            if(is_widget === false) {
              widgets[widget] = {
                where: [top,left],
                size: [1,1],
                isApp: true,
                name: widget_name,
                id: widget,
                img: widget_img,
                url: appLaunchUrl,
              };
            }

            if(is_widget === true) {
              widgets[widget] = {
                where: [top,left],
                size: [height,width],
                type: "iframe",
                isApp: false,
                name: widget_name,
                id: widget,
                img: widget_img,
                path: widget_src,
              };
            }

            localStorageSync(true);

          }
          catch (err) {
            _e(3);
          }
        }

        function removeWidget(widget) {
          try {
            delete widgets[widget];

            localStorageSync(false);
          }
          catch (err) {
            _e(4);
          }
        }


        $("#recently-closed-tabs-menu").live('mouseleave', function() {
          $(this).css("display", "none");
        });

        $("#recently-closed-tabs").live('click', function() {
          $(".close,.ui-2.x").trigger("click");
          $("#recently-closed-tabs-menu").toggle();
        });

        $("#toggleBmb").live("click", function(){
          if ($(this).is(':checked')) {
            $("#bookmarksBar").show();
            localStorage.setItem("showbmb", "yes");
          } else {
            $("#bookmarksBar").hide();
            localStorage.setItem("showbmb", "no");
          }
        });

        $("#toggle-grid").live("click", function(){
          if ($(this).is(':checked')) {
            $("body").addClass("perm-grid");
            localStorage.setItem("perm-grid", "yes");
          } else {
            $("body").removeClass("perm-grid");
            localStorage.setItem("perm-grid", "no");
          }
        });

        $("#toggle-app-names").live("click", function(){
          if ($(this).is(':checked')) {
            $("body").removeClass("hide-app-names");
            localStorage.setItem("hide-app-names", "no");
          } else {
            $("body").addClass("hide-app-names");
            localStorage.setItem("hide-app-names", "yes");
          }
        });

        $("#toggle-shortcut-names").live("click", function(){
          if ($(this).is(':checked')) {
            $("body").removeClass("hide-shortcut-names");
            localStorage.setItem("hide-shortcut-names", "no");
          } else {
            $("body").addClass("hide-shortcut-names");
            localStorage.setItem("hide-shortcut-names", "yes");
          }
        });

        $(".close,.ui-2.x").live("click", function(){
          $("body > .ui-2").fadeOut();
          $("#recently-closed-tabs-menu").fadeOut();

          $(".edit-shortcut-ui").remove();
          hscroll = true;
        });

        $(".url").live("mouseup", function(e){
          switch(e.which)
          {
              case 1:
                window.location = $(this).attr("data-url");
              break;
              case 2:
                window.open($(this).attr("data-url"));
              break;
              case 3:
                  // do nothing
              break;
          }
        });

        $("#app-drawer-button").live("click", function(){
          $(".ui-2#apps").fadeToggle();

          $(".ui-2#widgets").fadeOut();
          $(".ui-2#config").fadeOut();
          $("#recently-closed-tabs-menu").fadeOut();
          $(".ui-2#about").fadeOut();

          $(".ui-2#editor").fadeOut();
          $(".edit-shortcut-ui").remove();

        });

        var options_init = true;
        $("#config-button, .ui-2.config").live("click", function(){
          $(".ui-2#config").fadeToggle();

          $(".ui-2#widgets").fadeOut();
          $(".ui-2#apps").fadeOut();
          $("#recently-closed-tabs-menu").fadeOut();
          $(".ui-2#about").fadeOut();

          $(".ui-2#editor").fadeOut();
          $(".edit-shortcut-ui").remove();
        });

        $("#logo-button, .ui-2.logo").live("click", function(){
          $(".ui-2#about").fadeToggle();

          if(options_init === true) {
            options_init = false;

            (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/plusone.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
            })();

            (function() {
              var twitterScriptTag = document.createElement('script');
              twitterScriptTag.type = 'text/javascript';
              twitterScriptTag.async = true;
              twitterScriptTag.src = 'https://platform.twitter.com/widgets.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(twitterScriptTag, s);
            })();
          }

          $(".ui-2#widgets").fadeOut();
          $(".ui-2#apps").fadeOut();
          $("#recently-closed-tabs-menu").fadeOut();
          $(".ui-2#config").fadeOut();

          $(".ui-2#editor").fadeOut();
          $(".edit-shortcut-ui").remove();
        });

        $("#bg-img-css").live('keyup', function() {
          $(".bg-color").css("background", "" );
          $(".bg-color").css("background", $(this).val() );

          if($(this).val() === "") {
            $(".bg-color").css('backgroundColor', '#' + (localStorage.getItem("color-bg") || "221f20"));
          }

          localStorage.setItem("bg-img-css", $(this).val() );
        });

        var widgets_shown = false;
        $("#widget-drawer-button").live("click", function(){
          // if(widgets_shown === false) {
          //   widgets_shown = true;
          //   port.postMessage({
          //     fn: "setupDrawerWidgets",
          //     data: extensions,
          //   });
          // }
          
          $(".ui-2#widgets").fadeToggle();

          $(".ui-2#apps").fadeOut();
          $(".ui-2#config").fadeOut();
          $("#recently-closed-tabs-menu").fadeOut();
          $(".ui-2#about").fadeOut();

          $(".ui-2#editor").fadeOut();
          $(".edit-shortcut-ui").remove();
        });

        $("#delete").live("click", function(){
          var to_delete = null;
          to_delete = $(this).parent().parent();
          if(to_delete) {
            removeWidget( $(to_delete).attr("id") );

            $(".edit-shortcut-ui").remove();
            hscroll = true;

            var tiles = getCovered(to_delete);
            $(tiles.tiles).each(function(ind, elem){
                $(elem).addClass("empty");
            });

            $(to_delete).remove();
          }
        });

        $(".ui-2 .drawer-app-uninstall").live("click", function(e){
          var to_delete = null;
          var to_delete_name = null;
          to_delete = $(this).parent();
          to_delete_name = $(to_delete).find(".drawer-app-name").html();

          var r=confirm("Are you sure you want to uninstall " + to_delete_name + "?");
          if (r==true) {
            chrome.management.uninstall($(to_delete).attr("id"), reload() );
          }

          return false;
        });

        $("#reset-button").live("click", function(){
          var r=confirm("Are you sure you want to reset widget and app placements, stock widget preferences (notepad, coloring, etc.), and coloring preferences? Any customizations will be irrevocably lost.");
          if (r==true) {
            reset();
            reload();
          }
        });

        lock = true;
        $("#lock-button,#unlock-button").live("click", function() {
          if(lock === true) {
            // Unlock
            lock = false;
            $("body").addClass("unlocked").removeClass("locked");
            localStorage.setItem("lock", false );
            $(".iframe-mask").removeClass("hidden");
            $("#lock-button").css("display", "block");
            $("#unlock-button").css("display", "none");
            $(".tile").addClass("tile-grid");

            $(".ui-2#apps .drawer-app .url").removeClass("url").addClass("disabled-url");
            setTimeout(function() {
              $(".ui-2#apps .drawer-app .url").removeClass("url").addClass("disabled-url");
            }, 200);

          } else {
            // Lock
            lock = true;

            $(".edit-shortcut-ui").remove();
            hscroll = true;

            $("body").addClass("locked").removeClass("unlocked");
            localStorage.setItem("lock", true );
            $(".iframe-mask").addClass("hidden");
            $("#unlock-button").css("display", "block");
            $("#lock-button").css("display", "none");
            $(".tile").removeClass("tile-grid");

            $(".ui-2#apps .drawer-app .disabled-url").removeClass("disabled-url").addClass("url");
            setTimeout(function() {
              $(".ui-2#apps .drawer-app .disabled-url").removeClass("disabled-url").addClass("url");
            }, 250);
          }
        });

        $(".empty").live({
          mouseenter: function() {
            $(this).addClass("add-shortcut");
          },
          mouseleave: function() {
            $(".tile").removeClass("add-shortcut");
          }
        });

        function _e(_eNum) {
          console.log("Error #"+_eNum);
          _gaq.push(['_trackEvent', 'Error', _eNum]);
        }

      $(document).ready(function($) {
        placeWidgets();

        var qtipShared = {
          show: 'mouseover',
          hide: 'mouseout',
          style: {
            name: 'dark',
            tip: 'leftMiddle',
          },
          position: {
            corner: {
               target: 'rightMiddle',
               tooltip: 'leftMiddle'
            }
          }
        }

        var qtipUI2 = {
          show: 'mouseover',
          hide: 'mouseout',
          style: {
            name: 'dark',
            tip: 'topMiddle',
          },
          position: {
            corner: {
               target: 'bottomMiddle',
               tooltip: 'topMiddle'
            },
            adjust: {
              screen: true
            }
          }
        }

        $(".ui-2.x").qtip(
          $.extend({}, qtipUI2, { content: chrome.i18n.getMessage("ui_button_close") || "Close" })
        );
        $(".ui-2.help").qtip(
          $.extend({}, qtipUI2, { content: "Help" })
        );

        $(".ui-2.config").qtip(
          $.extend({}, qtipUI2, { content: "Configure" })
        );

        $(".ui-2#apps .download").qtip(
          $.extend({}, qtipUI2, { content: "Download Apps" })
        );

        $(".ui-2#widgets .download").qtip(
          $.extend({}, qtipUI2, { content: chrome.i18n.getMessage("ui_button_download") || "Download Widgets" })
        );

        $("#config-button").qtip(
          $.extend({}, qtipShared, { content: "Configure" })
        );
        $("#app-drawer-button").qtip(
          $.extend({}, qtipShared, { content: chrome.i18n.getMessage("ui_button_apps") || "Apps" })
        );
        $("#widget-drawer-button").qtip(
          $.extend({}, qtipShared, { content: chrome.i18n.getMessage("ui_button_widgets") || "Widgets" })
        );
        $("#unlock-button").qtip(
          $.extend({}, qtipShared, { content: chrome.i18n.getMessage("ui_button_unlock") || "Unlock" })
        );
        $("#lock-button").qtip(
          $.extend({}, qtipShared, { content: chrome.i18n.getMessage("ui_button_lock") || "Lock to Interact with Apps and Widgets" })
        );
        $("#recently-closed-tabs").qtip(
          $.extend({}, qtipShared, { content: chrome.i18n.getMessage("ui_button_rct") || "Recently Closed Tabs" })
        );


        $("#widget-holder > .shortcut > a").live('mouseup', function(e) {
          if( (this.href).indexOf("file://") != -1 ) {
            switch(e.which)
            {
                case 1:
                  chrome.tabs.update(null, {url: (this.href)});
                break;
                case 2:
                  chrome.tabs.create({url: (this.href)});
                break;
            }
          }
        });
        $("#widget-holder > .shortcut > a").live('click', function(e) {
          if( (this.href).indexOf("file://") != -1 ) {
            e.preventDefault();
            e.stopPropagation();
          }
        });

        $(".bg-color").css('backgroundColor', '#' + (localStorage.getItem("color-bg") || "221f20"));

        $("#colorselector-bg").ColorPicker({
          color: '#' + ( localStorage.getItem("color-bg") || "221f20") ,
          onShow: function (colpkr) {
            $(colpkr).fadeIn(500);
            return false;
          },
          onHide: function (colpkr) {
            $(colpkr).fadeOut(500);
            return false;
          },
          onChange: function (hsb, hex, rgb) {
            $(".bg-color").css('backgroundColor', '#' + hex);
            localStorage.setItem("color-bg", hex);
          }
        });

        $(".tile").animate({opacity: 0}, 500);
        chrome.management.getAll( setupDrawerApps );

        $(".ui-2.container").center();

        $(window).bind('resize scroll', function() {
          $(".ui-2.container").center();
        });

        setTimeout(function() {

          $.each(stock_widgets, function(id, widget){
            if(widget.isApp === false && widget.type !== "shortcut" && widget.type !== "app") {
              setupDrawerWidgets({
                request: {
                  body: {
                    height: widget.size[0],
                    width: widget.size[1],
                    path: widget.path,
                    poke: 1,
                  },
                  head: "mgmiemnjjchgkmgbeljfocdjjnpjnmcg-pokeback"
                },
                sender: {
                  id: "mgmiemnjjchgkmgbeljfocdjjnpjnmcg",
                  name: widget.name,
                  stock: id,
                  tab: null,
                }
              });
            }
          });

        }, 500);

        setTimeout(function() {
          port.postMessage({
            fn: "setupDrawerWidgets",
            data: extensions,
          });
        }, 1000);

        setTimeout(function() {
          if(bp) {
            // if(bp.recently_installed) {
            //   if(bp.recently_installed.isApp === false) {
            //     return;
            //   }
            //   $('#app-drawer-button').trigger('click');
            // }

            if(bp.recently_closed) {
              $("#recently-closed-tabs").css("display", "block");

              $.each(bp.recently_closed, function(id, tab) {
                if ( (tab.url).indexOf("chrome://") < 0 ) {
                  $('<a class="rctm-item" href="'+tab.url+'" target="_top">\
                      <div class="rctm-icon">\
                        <img src="chrome://favicon/'+tab.url+'">\
                      </div>\
                      <div class="rctm-link">'+ tab.title +'</div>\
                      </a>').appendTo("#recently-closed-tabs-menu");
                }
              });
            }
          }
        }, 750);

        if(localStorage.getItem("showbmb") === null) {
          localStorage.setItem("showbmb", "no");
        }

        if(localStorage.getItem("showbmb") === "yes") {
          $("#toggleBmb").attr('checked', 'checked');
        } else {
          $("#bookmarksBar").css("display", "none");
        }

        if(localStorage.getItem("perm-grid") === null) {
          localStorage.setItem("perm-grid", "no");
        }

        if(localStorage.getItem("perm-grid") === "yes") {
          $("body").addClass("perm-grid");
          $("#toggle-grid").attr('checked', 'checked');
        }

        if(localStorage.getItem("hide-app-names") === null) {
          localStorage.setItem("hide-app-names", "no");
        }

        if(localStorage.getItem("hide-app-names") === "yes") {
          $("body").addClass("hide-app-names");
        } else {
          $("#toggle-app-names").attr('checked', 'checked');
        }

        if(localStorage.getItem("hide-shortcut-names") === null) {
          localStorage.setItem("hide-shortcut-names", "no");
        }

        if(localStorage.getItem("hide-shortcut-names") === "yes") {
          $("body").addClass("hide-shortcut-names");
        } else {
          $("#toggle-shortcut-names").attr('checked', 'checked');
        }

        if(localStorage.getItem("lock") === "false") {
          $('#unlock-button').trigger('click');
        } else {
          $("body").addClass("locked").removeClass("unlocked");
        }

        if(localStorage.getItem("bg-img-css") && localStorage.getItem("bg-img-css") !== "") {
          $("body").css("background", localStorage.getItem("bg-img-css") );
          $("#bg-img-css").val( localStorage.getItem("bg-img-css") );
        }

        // End .ready
      });
    </script>
  </head>

  <body class="bg-color">
    <div class="scroll-helper">
      <!-- Fixes an issue where scrolling sometimes didn't work. -->
    </div>
    <ul id="bookmarksBar"></ul>

    <div id="widget-holder"></div>

    <div id="top-buttons">
      <div id="logo-button" class="side-button">
        &nbsp;
      </div>
      <div id="config-button" class="side-button">
        &nbsp;
      </div>
      <div id="app-drawer-button" class="side-button">
        &nbsp;
      </div>
      <div id="widget-drawer-button" class="side-button">
        &nbsp;
      </div>
      <div id="recently-closed-tabs" class="side-button hidden">
        &nbsp;
      </div>
      <div id="lock-button" class="side-button hidden">
        &nbsp;
      </div>
      <div id="unlock-button" class="side-button">
        &nbsp;
      </div>
    </div>

    <div id="recently-closed-tabs-menu"></div>

    <div id="about" class="ui-2 container">
      <div class="ui-2 header">
        <div class="ui-2 left">
          <div class="ui-2 logo"></div>
          <div class="ui-2 name">
            Awesome New Tab Page
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname">About</span>
          </div>
        </div>
        <div class="ui-2 right">
          <div class="ui-2 config"></div>
          <div class="ui-2 help url" data-url="https://ntp.uservoice.com/"></div>
          <div class="ui-2 vr"></div>
          <div class="ui-2 x"></div>
        </div>
      </div>

      <div class="ui-2 contents">
        <div id="about-contrib" class="ui-2">
          <h3><script>document.write(chrome.i18n.getMessage("ui_config_contrib"));</script></h3>
          <p>
            This project wouldn't exist without the hard work, feedback, ideas, translations, and support by all of you.
          </p>
          <p class="ilb">
            <a href="https://github.com/michaelhart/Awesome-New-Tab-Page/contributors" class="bubble">
              Developers
            </a>
          </p>
          <p class="ilb">
            <a href="http://crowdin.net/project/antp" class="bubble">
              Translators
            </a>
          </p>
          <p class="ilb">
            <a href="https://ntp.uservoice.com/forums/136895-feedback" class="bubble">
              Users
            </a>
          </p>
          <p>
            Click the links above to see these awesome people in action!
          </p>
        </div>

        <div id="about-dev" class="ui-2">
          <h3>Developers</h3>

          <p class="ilb">
            <a href="https://github.com/michaelhart/Awesome-New-Tab-Page" class="bubble">
              Fork Awesome New Tab Page
            </a>
          </p>

          <p>Did you know that making a widget for Awesome New Tab Page is as easy as making a website?</p>
          <p>Learn more here:
            <u><a href="https://github.com/michaelhart/NTP-Widget-Shell/blob/master/background.html">github.com</a></u>.
          </p>
        </div>

        <div id="about-rate" class="ui-2">
          <h3>Rate</h3>
          <p class="ilb">
            <a href="https://chrome.google.com/webstore/detail/mgmiemnjjchgkmgbeljfocdjjnpjnmcg/reviews" class="bubble">
              <img src="/images/ui-2/stars.png">
            </a>
          </p>
          <p class="ilb">
            Rate this extension
          </p>
        </div>

        <div id="about-share" class="ui-2">
          <h3><script>document.write(chrome.i18n.getMessage("ui_config_share"));</script></h3>
          <p><script>document.write(chrome.i18n.getMessage("ui_config_share1"));</script></p>
          <g:plusone expandTo="top" size="medium"
          href="https://chrome.google.com/webstore/detail/mgmiemnjjchgkmgbeljfocdjjnpjnmcg"></g:plusone>

          <a href="https://twitter.com/share" class="twitter-share-button" 
            data-url="https://chrome.google.com/webstore/detail/mgmiemnjjchgkmgbeljfocdjjnpjnmcg"
            data-text="Awesome New Tab Page: Making the New Tab Page in Google Chrome awesome."
            data-count="horizontal" data-via="NewTabPage" data-related="HartMichael:Developer">Tweet</a>


          <br />

          <g:plus href="https://plus.google.com/101062285048075360930" width="300" height="131" theme="light"></g:plus>
        </div>
      </div>
    </div>

    <div id="config" class="ui-2 container">
      <div class="ui-2 header">
        <div class="ui-2 left">
          <div class="ui-2 logo"></div>
          <div class="ui-2 name">
            Awesome New Tab Page
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname">Configure</span>
          </div>
        </div>
        <div class="ui-2 right">
          <div class="ui-2 config"></div>
          <div class="ui-2 help url" data-url="https://ntp.uservoice.com/"></div>
          <div class="ui-2 vr"></div>
          <div class="ui-2 x"></div>
        </div>
      </div>

      <div class="ui-2 contents">
        <div id="config-general" class="ui-2">
          <h3><script>document.write(chrome.i18n.getMessage("ui_config_general"));</script></h3>
          <div id="toggleBmb-holder">
            <input id="toggleBmb" type="checkbox" name="show" value="true" />
            <p class="ilb"><script>document.write(chrome.i18n.getMessage("ui_config_bmb"));</script></p>
          </div>
          <p>This bookmark bar isn't as polished as it could be. I'm hoping Chrome's developers
            hear my begging for an API to use the same in-page bookmark bar that the original NTP uses, but until then...</p>

          <div id="toggle-grid-holder">
            <input id="toggle-grid" type="checkbox" name="show" value="true" />
            <p class="ilb"><script>document.write(chrome.i18n.getMessage("ui_config_shgrid"));</script></p>
          </div> 

          <div id="toggle-app-names-holder">
            <input id="toggle-app-names" type="checkbox" name="show" value="true" />
            <p class="ilb">Show / Hide App Names (On NTP Only)</p>
          </div>

          <div id="toggle-shortcut-names-holder">
            <input id="toggle-shortcut-names" type="checkbox" name="show" value="true" />
            <p class="ilb">Show / Hide Shortcut Names + Favicons (On NTP Only)</p>
          </div>

          <div id="reset-button" class="bubble ilb">
            <script>document.write(chrome.i18n.getMessage("ui_button_reset"));</script>
          </div>
          <p class="ilb">
            This button will allow you to undo all changes you've made to Awesome New Tab Page.
          </p>
        </div>

        <div id="config-background" class="ui-2">
          <h3><script>document.write(chrome.i18n.getMessage("ui_config_bg"));</script></h3>

          <div class="bubble ilb bg-color">
            &nbsp;&nbsp;&nbsp;&nbsp;
          </div>
          <div id="colorselector-bg" class="bubble ilb">
            <script>document.write(chrome.i18n.getMessage("ui_button_bgc"));</script>
          </div>
          <p>
            <script>document.write(chrome.i18n.getMessage("ui_config_bgimg1"));</script>
            <a href="http://www.w3schools.com/css/tryit.asp?filename=trycss_background_shorthand2">
              <u>Learn More</u>.
            </a>
          </p>
          <p>
            <input id="bg-img-css" type="text" name="bg-img-css" />
          </p>
          <p><script>document.write(chrome.i18n.getMessage("ui_config_bgimg2"));</script></p>
          <pre>url('http://mh.mycdn.co/labs/antp/m.png') repeat right top</pre>
          <p><script>document.write(chrome.i18n.getMessage("ui_config_bgimg3"));</script></p>
        </div>
      </div>
    </div>

    <div id="apps" class="ui-2 container">
      <div class="ui-2 header">
        <div class="ui-2 left">
          <div class="ui-2 logo"></div>
          <div class="ui-2 name">
            Awesome New Tab Page
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname">
              <script>document.write(chrome.i18n.getMessage("ui_button_apps"));</script>
            </span>
          </div>
        </div>
        <div class="ui-2 right">
          <div class="ui-2 download url" data-url="https://chrome.google.com/webstore/?utm_source=google-chrome-extension&utm_medium=awesomenewtabpage&utm_campaign=antp-download-apps"></div>
          <div class="ui-2 config"></div>
          <div class="ui-2 help url" data-url="https://ntp.uservoice.com/"></div>
          <div class="ui-2 vr"></div>
          <div class="ui-2 x"></div>
        </div>
      </div>

      <div class="ui-2 contents"></div>
    </div>

    <div id="widgets" class="ui-2 container">
      <div class="ui-2 header">
        <div class="ui-2 left">
          <div class="ui-2 logo"></div>
          <div class="ui-2 name">
            Awesome New Tab Page
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname">
              <script>document.write(chrome.i18n.getMessage("ui_button_widgets"));</script>
            </span>
          </div>
        </div>
        <div class="ui-2 right">
          <div class="ui-2 download url" data-url="https://chrome.google.com/webstore/search/%22Awesome New Tab Page%22?utm_source=google-chrome-extension&utm_medium=awesomenewtabpage&utm_campaign=antp-download-widgets"></div>
          <div class="ui-2 config"></div>
          <div class="ui-2 help url" data-url="https://ntp.uservoice.com/"></div>
          <div class="ui-2 vr"></div>
          <div class="ui-2 x"></div>
        </div>
      </div>

      <div class="ui-2 contents" id="widget-drawer"></div>
    </div>

    <div id="editor" class="ui-2 container">
      <div class="ui-2 header">
        <div class="ui-2 left">
          <div class="ui-2 logo"></div>
          <div class="ui-2 name">
            Awesome New Tab Page
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname">
              Tile Editor
            </span>
            <span class="ui-2 crumb">&nbsp;</span>
            <span class="ui-2 subname" id="editor-name">
              &nbsp;
            </span>
          </div>
        </div>
        <div class="ui-2 right">
          <div class="ui-2 config"></div>
          <div class="ui-2 help url" data-url="https://ntp.uservoice.com/"></div>
          <div class="ui-2 vr"></div>
          <div class="ui-2 x"></div>
        </div>
      </div>

      <div class="ui-2 contents">
        <div id="tile-editor-right">
            <h3>Name</h3>
            <p>What do you want to call it?</p>
            <input id="shortcut_name" type="text" />
            <p>
              <input id="shortcut_name_show" type="checkbox" />
              Show / Hide Name
            </p>

            <h3>Color</h3>
            <div id="shortcut_colorpicker" class="bubble ilb">
              Change background color
            </div>
          <div class="hide-if-app">
            <h3>URL</h3>
            <p>Enter the URL you'd like to link to, such as http://www.google.com/</p>
            <input id="shortcut_url" type="text" />
            <p class="tip">
              Note: This option is not available for installed apps.
            </p>
          </div>
          <div class="hide-if-app">
            <h3>Icon</h3>
            <p>Enter a URL to an image to change the icon. 128px by 128px is recommended.</p>
            <input id="img_url" type="text" />
            <p class="tip">
              Note: This option is not available for installed apps.
            </p>
            <p class="tip">
              Advanced: Hide the name and use an image that's 200px by 200px to completely
              customize the tile.
            </p>
          </div>
        </div>

        <div id="tile-editor-left">
          <h3>Completely Transparent Background</h3>
          <p>
            <input id="shortcut_background_transparent" type="checkbox" />
            Disable this tile's background
          </p>
          <p class="tip">
            Tip: If you check this box, you may also want to hide the name.
          </p>

        </div>

        <div id="fake-tile-wrapper">
          <h3>Preview</h3>
          <div id="fake-tile-background" class="bg-color">
            <div class="fake-tile" id="preview-tile">
              <div class="app-name"></div>
            </div>
            <div class="fake-tile" id="ft0"></div>
            <div class="fake-tile" id="ft1"></div>
            <div class="fake-tile" id="ft2"></div>
            <div class="fake-tile" id="ft3"></div>
            <div class="fake-tile" id="ft4"></div>
            <div class="fake-tile" id="ft5"></div>
            <div class="fake-tile" id="ft6"></div>
            <div class="fake-tile" id="ft7"></div>
            <div class="fake-tile" id="ft8"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="groups">

      <ul id="1" class="group">
        <li class="tile empty" id="0x0" data-land-top="0" data-land-left="0">&nbsp;</li>
        <li class="tile empty" id="0x1" data-land-top="0" data-land-left="1">&nbsp;</li>
        <li class="tile empty" id="0x2" data-land-top="0" data-land-left="2">&nbsp;</li>
        <li class="tile empty" id="0x3" data-land-top="0" data-land-left="3">&nbsp;</li>

        <li class="tile empty" id="1x0" data-land-top="1" data-land-left="0">&nbsp;</li>
        <li class="tile empty" id="1x1" data-land-top="1" data-land-left="1">&nbsp;</li>
        <li class="tile empty" id="1x2" data-land-top="1" data-land-left="2">&nbsp;</li>
        <li class="tile empty" id="1x3" data-land-top="1" data-land-left="3">&nbsp;</li>

        <li class="tile empty" id="2x0" data-land-top="2" data-land-left="0">&nbsp;</li>
        <li class="tile empty" id="2x1" data-land-top="2" data-land-left="1">&nbsp;</li>
        <li class="tile empty" id="2x2" data-land-top="2" data-land-left="2">&nbsp;</li>
        <li class="tile empty" id="2x3" data-land-top="2" data-land-left="3">&nbsp;</li>
      </ul>

      <ul id="2" class="group">
        <li class="tile empty" id="0x4" data-land-top="0" data-land-left="4">&nbsp;</li>
        <li class="tile empty" id="0x5" data-land-top="0" data-land-left="5">&nbsp;</li>
        <li class="tile empty" id="0x6" data-land-top="0" data-land-left="6">&nbsp;</li>
        <li class="tile empty" id="0x7" data-land-top="0" data-land-left="7">&nbsp;</li>

        <li class="tile empty" id="1x4" data-land-top="1" data-land-left="4">&nbsp;</li>
        <li class="tile empty" id="1x5" data-land-top="1" data-land-left="5">&nbsp;</li>
        <li class="tile empty" id="1x6" data-land-top="1" data-land-left="6">&nbsp;</li>
        <li class="tile empty" id="1x7" data-land-top="1" data-land-left="7">&nbsp;</li>

        <li class="tile empty" id="2x4" data-land-top="2" data-land-left="4">&nbsp;</li>
        <li class="tile empty" id="2x5" data-land-top="2" data-land-left="5">&nbsp;</li>
        <li class="tile empty" id="2x6" data-land-top="2" data-land-left="6">&nbsp;</li>
        <li class="tile empty" id="2x7" data-land-top="2" data-land-left="7">&nbsp;</li>
      </ul>

      <ul id="3" class="group">
        <li class="tile empty" id="0x8" data-land-top="0" data-land-left="8">&nbsp;</li>
        <li class="tile empty" id="0x9" data-land-top="0" data-land-left="9">&nbsp;</li>
        <li class="tile empty" id="0x10" data-land-top="0" data-land-left="10">&nbsp;</li>
        <li class="tile empty" id="0x11" data-land-top="0" data-land-left="11">&nbsp;</li>

        <li class="tile empty" id="1x8" data-land-top="1" data-land-left="8">&nbsp;</li>
        <li class="tile empty" id="1x9" data-land-top="1" data-land-left="9">&nbsp;</li>
        <li class="tile empty" id="1x10" data-land-top="1" data-land-left="10">&nbsp;</li>
        <li class="tile empty" id="1x11" data-land-top="1" data-land-left="11">&nbsp;</li>

        <li class="tile empty" id="2x8" data-land-top="2" data-land-left="8">&nbsp;</li>
        <li class="tile empty" id="2x9" data-land-top="2" data-land-left="9">&nbsp;</li>
        <li class="tile empty" id="2x10" data-land-top="2" data-land-left="10">&nbsp;</li>
        <li class="tile empty" id="2x11" data-land-top="2" data-land-left="11">&nbsp;</li>
      </ul>

      <ul id="4" class="group">
        <li class="tile empty" id="0x12" data-land-top="0" data-land-left="12">&nbsp;</li>
        <li class="tile empty" id="0x13" data-land-top="0" data-land-left="13">&nbsp;</li>
        <li class="tile empty" id="0x14" data-land-top="0" data-land-left="14">&nbsp;</li>
        <li class="tile empty" id="0x15" data-land-top="0" data-land-left="15">&nbsp;</li>

        <li class="tile empty" id="1x12" data-land-top="1" data-land-left="12">&nbsp;</li>
        <li class="tile empty" id="1x13" data-land-top="1" data-land-left="13">&nbsp;</li>
        <li class="tile empty" id="1x14" data-land-top="1" data-land-left="14">&nbsp;</li>
        <li class="tile empty" id="1x15" data-land-top="1" data-land-left="15">&nbsp;</li>

        <li class="tile empty" id="2x12" data-land-top="2" data-land-left="12">&nbsp;</li>
        <li class="tile empty" id="2x13" data-land-top="2" data-land-left="13">&nbsp;</li>
        <li class="tile empty" id="2x14" data-land-top="2" data-land-left="14">&nbsp;</li>
        <li class="tile empty" id="2x15" data-land-top="2" data-land-left="15">&nbsp;</li>
      </ul>

    </div>


    <script type="text/javascript">
      prepareTiles();
    </script>
    <script type="text/javascript" src="/javascript/hscroll.js"></script>
    <script type="text/javascript" src="/javascript/bookmarkbar.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-26076327-1']);
      _gaq.push(['_trackPageview']);

      _gaq.push(['_trackEvent', 'Version', chrome.app.getDetails().version]);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>